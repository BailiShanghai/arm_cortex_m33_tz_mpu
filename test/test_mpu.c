#include "test_mpu.h"

void mpu_setup(void)
{
	MPU_MAIR0 = 0x00000033;
	MPU_MAIR1 = 0x0000000C;
	MPU_RNR = 0x00;
	MPU_RBAR = (0x00000000 & 0xFFFFFFC0) | (0x00 << 3) | (0x03 << 1) | 0x00;
	MPU_RLAR = (0x00800000 & 0xFFFFFFC0) | (0x00 << 1) | 0x01;
	
	MPU_RNR = 0x01;
	MPU_RBAR = (0x20000000 & 0xFFFFFFC0) | (0x00 << 3) | (0x01 << 1) | 0x01;
	MPU_RLAR = (0x20800000 & 0xFFFFFFC0) | (0x00 << 1) | 0x01;

	MPU_RNR = 0x02;
	MPU_RBAR = (0x40000000 & 0xFFFFFFC0) | (0x00 << 3) | (0x01 << 1) | 0x01;
	MPU_RLAR = (0x40800000 & 0xFFFFFFC0) | (0x04 << 1) | 0x01;
	
	MPU_RNR = 0x03;
	MPU_RBAR = (0x70000000 & 0xFFFFFFC0) | (0x00 << 3) | (0x01 << 1) | 0x01;
	MPU_RLAR = (0x70800000 & 0xFFFFFFC0) | (0x04 << 1) | 0x01;
	
	MPU_CTRL = (0x00 << 2) | 0x01;

	SCB_EnableICache();
	SCB_EnableDCache();
}

